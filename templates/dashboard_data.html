<!-- dashboard_data.html -->
{% extends "default_layout.html" %}

{% block title %}
Reviews Dashboard
{% endblock %}

{% block content %}
<h1 class="mb-4">Bad Reviews</h1>
<hr>

<!-- Search Form -->
<form method="GET" action="{{ url_for('dashboard') }}" class="d-flex mb-3">
    <input class="form-control me-2" type="search" name="search" placeholder="Search" aria-label="Search" value="{{ search_query }}">
    <button class="btn btn-outline-success" type="submit">Search</button>
</form>

<!-- Button to export table data as CSV -->
<a href="{{ url_for('export_csv') }}" class="btn btn-success mb-3">Export as CSV</a>

<!-- Collapsible table -->
<div id="reviewTable">
    <table class="table table-bordered border-primary">
        <thead class="table-dark">
            <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Email</th>
                <th>Rating</th>
                <th>Comment</th>
                <th>Date Submitted</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for review in reviews %}
            <tr>
                <td>{{ loop.index + (pagination.page - 1) * pagination.per_page }}</td>
                <td>{{ review.name }}</td>
                <td>{{ review.email }}</td>
                <td>{{ review.rating }}</td>
                <td>{{ review.comment }}</td>
                <td>{{ review.date_submitted }}</td>
                <td>
                    <!-- Link to view review details -->
                    <a href="{{ url_for('view_review', encoded_email=review.email|urlencode) }}" class="btn btn-info btn-sm">View Details</a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

{% if pagination.pages > 1 %}
<!-- Pagination controls -->
<nav aria-label="Page navigation example">
    <ul class="pagination justify-content-center">
        {% if pagination.has_prev %}
        <li class="page-item">
            <a class="page-link" href="{{ url_for('dashboard', page=pagination.prev_num, search=search_query) }}">Previous</a>
        </li>
        {% else %}
        <li class="page-item disabled">
            <span class="page-link">Previous</span>
        </li>
        {% endif %}

        {% for page_num in pagination.iter_pages() %}
        {% if page_num %}
        <li class="page-item {% if page_num == pagination.page %}active{% endif %}">
            <a class="page-link" href="{{ url_for('dashboard', page=page_num, search=search_query) }}">{{ page_num }}</a>
        </li>
        {% else %}
        <li class="page-item disabled">
            <span class="page-link">â€¦</span>
        </li>
        {% endif %}
        {% endfor %}

        {% if pagination.has_next %}
        <li class="page-item">
            <a class="page-link" href="{{ url_for('dashboard', page=pagination.next_num, search=search_query) }}">Next</a>
        </li>
        {% else %}
        <li class="page-item disabled">
            <span class="page-link">Next</span>
        </li>
        {% endif %}
    </ul>
</nav>
{% endif %}
{% endblock %}
